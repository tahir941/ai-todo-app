{"ast":null,"code":"// src/redux/slices/authSlice.js\nimport{createSlice,createAsyncThunk}from'@reduxjs/toolkit';import axios from'axios';// Load token and user from localStorage (optional: user persistence)\nconst token=localStorage.getItem('token');const user=localStorage.getItem('user')?JSON.parse(localStorage.getItem('user')):null;const initialState={user:user,token:token||null,status:'idle',// 'idle' | 'loading' | 'succeeded' | 'failed'\nerror:null};// Async thunk for login\nexport const loginUser=createAsyncThunk('auth/loginUser',async(_ref,thunkAPI)=>{let{email,password}=_ref;try{const response=await axios.post('http://localhost:5000/api/auth/login',{email,password});console.log('Login response:',response);// Add this log\nconst{token,user,error}=response.data;if(error){// backend sent error but with 200 status\nreturn thunkAPI.rejectWithValue(error);}if(!token||!user){return thunkAPI.rejectWithValue('Invalid login response');}localStorage.setItem('token',token);return{token,user};}catch(error){var _error$response,_error$response$data;return thunkAPI.rejectWithValue(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Login failed');}});// Async thunk for register\nexport const registerUser=createAsyncThunk('auth/registerUser',async(_ref2,thunkAPI)=>{let{username,email,password}=_ref2;try{const response=await axios.post('http://localhost:5000/api/auth/register',{username,email,password});const{token,user}=response.data;// Save token and user to localStorage\nlocalStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(user));return{token,user};}catch(error){var _error$response2,_error$response2$data;return thunkAPI.rejectWithValue(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||'Registration failed');}});const authSlice=createSlice({name:'auth',initialState,reducers:{logout:state=>{state.user=null;state.token=null;state.status='idle';state.error=null;localStorage.removeItem('token');localStorage.removeItem('user');}},extraReducers:builder=>{builder// login\n.addCase(loginUser.pending,state=>{state.status='loading';state.error=null;}).addCase(loginUser.fulfilled,(state,action)=>{state.status='succeeded';state.user=action.payload.user;state.token=action.payload.token;state.error=null;}).addCase(loginUser.rejected,(state,action)=>{state.status='failed';state.error=action.payload;})// register\n.addCase(registerUser.pending,state=>{state.status='loading';state.error=null;}).addCase(registerUser.fulfilled,(state,action)=>{state.status='succeeded';state.user=action.payload.user;state.token=action.payload.token;state.error=null;}).addCase(registerUser.rejected,(state,action)=>{state.status='failed';state.error=action.payload;});}});export const{logout}=authSlice.actions;export default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","token","localStorage","getItem","user","JSON","parse","initialState","status","error","loginUser","_ref","thunkAPI","email","password","response","post","console","log","data","rejectWithValue","setItem","_error$response","_error$response$data","registerUser","_ref2","username","stringify","_error$response2","_error$response2$data","authSlice","name","reducers","logout","state","removeItem","extraReducers","builder","addCase","pending","fulfilled","action","payload","rejected","actions","reducer"],"sources":["C:/Users/ENGINES/Desktop/ai-todo-app/client/src/redux/slices/authSlice.js"],"sourcesContent":["// src/redux/slices/authSlice.js\r\nimport { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport axios from 'axios';\r\n\r\n// Load token and user from localStorage (optional: user persistence)\r\nconst token = localStorage.getItem('token');\r\nconst user = localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')) : null;\r\n\r\nconst initialState = {\r\n  user: user,\r\n  token: token || null,\r\n  status: 'idle', // 'idle' | 'loading' | 'succeeded' | 'failed'\r\n  error: null,\r\n};\r\n\r\n// Async thunk for login\r\nexport const loginUser = createAsyncThunk(\r\n  'auth/loginUser',\r\n  async ({ email, password }, thunkAPI) => {\r\n    try {\r\n      const response = await axios.post('http://localhost:5000/api/auth/login', { email, password });\r\n      console.log('Login response:', response);  // Add this log\r\n      const { token, user, error } = response.data;\r\n\r\n      if (error) {\r\n        // backend sent error but with 200 status\r\n        return thunkAPI.rejectWithValue(error);\r\n      }\r\n\r\n      if (!token || !user) {\r\n        return thunkAPI.rejectWithValue('Invalid login response');\r\n      }\r\n\r\n      localStorage.setItem('token', token);\r\n      return { token, user };\r\n    } catch (error) {\r\n      return thunkAPI.rejectWithValue(error.response?.data?.error || 'Login failed');\r\n    }\r\n  }\r\n);\r\n\r\n\r\n// Async thunk for register\r\nexport const registerUser = createAsyncThunk(\r\n  'auth/registerUser',\r\n  async ({ username, email, password }, thunkAPI) => {\r\n    try {\r\n      const response = await axios.post('http://localhost:5000/api/auth/register', {\r\n        username,\r\n        email,\r\n        password,\r\n      });\r\n      const { token, user } = response.data;\r\n      // Save token and user to localStorage\r\n      localStorage.setItem('token', token);\r\n      localStorage.setItem('user', JSON.stringify(user));\r\n      return { token, user };\r\n    } catch (error) {\r\n      return thunkAPI.rejectWithValue(\r\n        error.response?.data?.error || 'Registration failed'\r\n      );\r\n    }\r\n  }\r\n);\r\n\r\nconst authSlice = createSlice({\r\n  name: 'auth',\r\n  initialState,\r\n  reducers: {\r\n    logout: (state) => {\r\n      state.user = null;\r\n      state.token = null;\r\n      state.status = 'idle';\r\n      state.error = null;\r\n      localStorage.removeItem('token');\r\n      localStorage.removeItem('user');\r\n    },\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder\r\n      // login\r\n      .addCase(loginUser.pending, (state) => {\r\n        state.status = 'loading';\r\n        state.error = null;\r\n      })\r\n      .addCase(loginUser.fulfilled, (state, action) => {\r\n        state.status = 'succeeded';\r\n        state.user = action.payload.user;\r\n        state.token = action.payload.token;\r\n        state.error = null;\r\n      })\r\n      .addCase(loginUser.rejected, (state, action) => {\r\n        state.status = 'failed';\r\n        state.error = action.payload;\r\n      })\r\n\r\n      // register\r\n      .addCase(registerUser.pending, (state) => {\r\n        state.status = 'loading';\r\n        state.error = null;\r\n      })\r\n      .addCase(registerUser.fulfilled, (state, action) => {\r\n        state.status = 'succeeded';\r\n        state.user = action.payload.user;\r\n        state.token = action.payload.token;\r\n        state.error = null;\r\n      })\r\n      .addCase(registerUser.rejected, (state, action) => {\r\n        state.status = 'failed';\r\n        state.error = action.payload;\r\n      });\r\n  },\r\n});\r\n\r\nexport const { logout } = authSlice.actions;\r\nexport default authSlice.reducer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}